# Coding Standards

## Table of Contents

- [Coding Standards](#coding-standards)
  - [Table of Contents](#table-of-contents)
  - [Components](#components)
    - [Naming](#naming)
    - [Conditional Rendering](#conditional-rendering)
    - [Match Media](#match-media)
    - [Application State](#application-state)
  - [CSS](#css)
    - [Nesting selectors](#nesting-selectors)
    - [Avoid margin](#avoid-margin)
    - [Mobile-First](#mobile-first)
    - [Use mixins for repetitive styles](#use-mixins-for-repetitive-styles)
  - [Accessibility](#accessibility)
  - [Testing](#testing)
    - [Avoid E2E spec outside header](#avoid-e2e-spec-outside-header)

## Components

### Naming

For higher level sections of the navigation, connect with the designers on the naming. This makes it easier to find in the repository, and makes the communication within the team smoother. [Link to document here](https://teams.microsoft.com/l/file/F056C44E-4911-4323-A080-BC3CB88443CE?tenantId=56564e0f-83d3-4b52-92e8-a6bb9ea36564&fileType=pptx&objectUrl=https%3A%2F%2Fporsche.sharepoint.com%2Fsites%2FHomeNavigation%2FShared%20Documents%2FProduct%2FNaming%20Standards.pptx&baseUrl=https%3A%2F%2Fporsche.sharepoint.com%2Fsites%2FHomeNavigation&serviceName=teams&threadId=19:6d44fca4319f48eba26e0f135ce955d7@thread.skype&groupId=32ffe2a9-7d88-4945-bd1d-6e73feb9c955)

### Conditional Rendering

Using conditional rendering - render a component only `if` required - instead of using CSS display none and block.
This could result in much less rendering time since the number of components rendered is much less and makes the resultant DOM structure easier to navigate and understand.

### Match Media

(Under review)

Using the JS window.matchMedia API instead of using refs to change displays to block and none in case of different components for different devices to give a general performance boost.

### Application State

Make sure the stencil store defaults work in every component.
We might not be aware that this leads to problems, due to the fact that mostly on render the strore doesn't fall back to defaults,
however for tests this bears problems and certain conditions we are not aware of (like fetch content fails), might lead to breaking state due to that.

## CSS

### Nesting selectors

Don't nest selectors more than 2 levels deep. 

** Bad **
```scss
.page {
  .content {
    .title {
      // STOP HERE!
    }
  }
}
```

** Good **

```scss
.menu {
  .content {
    
  }
}

.menu-title {

}
```

Too much nesting is harder to read, and makes the CSS too specific and brittle. For example, when .content is removed, the styling for the .title now no longer works!

### Avoid margin
When working with sub components, let the parents decide the space and avoid children occupy space via margin.

** Disencouraged **
```html
<phn-menu-desktop-level-1 style="...">
  <phn-car-series-list style="margin-left: 1.25rem; ..." />
</phn-menu-desktop-level-1>
```

** Encouraged **
```html
<phn-car-series-level-1 style="padding-left: 1.25rem; ...">
  <phn-car-series-list style="..." />
<phn-car-series-level-1 />
```

Also, consider using [flexbox](https://css-tricks.com/snippets/css/a-guide-to-flexbox/) if [IE11](https://caniuse.com/#feat=flexbox) allows for it.

There are some edge cases when we might still need to use margin:
1. Following the page [margin](https://designsystem.porsche.com/v1/#/components/layout/grid#design) guidelines
2. Occupying negative space, like with the [crest overlap](https://github.com/porsche-home-nav/porsche-home-and-nav/blob/master/packages/navigation/src/components/crest/crest.scss#L22)

### <a name="mobile-first"></a>Mobile-First
Since our designs follow a mobile-first design approach, it maakes most sense to have our development follow the same approach and build the mobile versions and on top of the mobile version of the components, build the other viewport versions.

Adding a couple of guidelines below:
- Having the mobile implementation as a default layer to build on: We declare styles first for the smallest screen (320px/375px), only afterwards changing them when we need to, using p-media-query queries.
- Test on actual devices: There are countless quirks of iOS, Android, and other browsers of all versions, so make sure you see what most users will see.

Lastly, we tried to implement proper mobile-first in most of the components, refer header.scss for e.g. for an overview.

### Use mixins for repetitive styles

There are some styles which we have to put in several places, and it becomes tedious to change them when we have to.

One example is the focus style that we take from the design system when we have to use a custom focusable element.

```scss
@import '../../scss/index';

.selector-focusable-element {
  // other css
  &:focus {
    @include design-system__focus();
  }
}
```

To define the mixin:

```scss
// _mixins.scss

@mixin design-system__focus() {
  outline-width: 2px;
  outline-style: solid;
  outline-offset: 1px;
  outline-color: $p-color-theme-light-state-focus;
}

```

Naming strategy can be specific: `context-of-mixin__description`

## Accessibility

As much as possible, use semantic html elements such as:

`<button>` for elements that have an action

`<link>` for elements that go to another page

`<ul>` and `<li>` for list and list items

`<button>`, for instance, already handles enter and space keyboard events when the `click` event gets triggered. This also includes screen reader space command. You don't need to add extra code. If you want to reset the style, a mixin is already available in `_mixins.scss`

## Testing

### Avoid E2E spec outside header
`newE2EPage()` should ideally only be used in `header.tsx`, which is the top level component. As we are not a component library, it's unnecessary to have them in the smaller components

Happy Coding!!!
